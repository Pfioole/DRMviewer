{% extends 'base4.html' %}

{% block page_content %}

<div class="container">
    <div class="row"><div class="col">Study Dataset Path: </div></div>
    <div class="row">
      <div class="col-9"><input class="form-control" value="{{ the_path }}" data-bind="value: studypathText"/></div>
      <div class="col"><button class="btn btn-primary" data-bind="click: fetchDatasets">Select</button></div>
    </div>
</div></br>

<!-- Tabs for Create Query and Re-Use Query -->
<div class="container">
    <ul class="nav nav-tabs nav-justified">
      <li class="nav-item">
        <a class="nav-link active" href="#">Create Query</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Re-use query</a>
      </li>
    </ul>
</div>

<!-- Query building interface -->
<div class="container">
    <div class="row">
        <div class="col-sm">
            <strong>Select left file to merge:</strong></br>
            <select data-bind="options: datasetsList, value: sq.leftFile, event:{change: fetchLeftFields}" class="form-control" ></select>

            <label for="colselect">Select Left fields:</label>
			<select data-bind="options: leftFieldList, value: leftField, event:{change: addLeftFieldSelect}" id="leftcolselect" class="form-control" name="leftcolselect" size="10"></select>
        </div>

        <div class="col-sm">
            <strong>Join:</strong></br>
            <table class="table table-sm ">
                <th>Type</th><th>Left</th><th>Right</th><th>X</th>
                <tbody data-bind="foreach: links">
                    <td><select data-bind="options: $root.joinTypes, value: joinType" class="form-control-sm"></select></td>
                    <td><select data-bind="options: $root.leftFieldList, value: leftLink" class="form-control-sm"></select></td>
                    <td><select data-bind="options: $root.rightFieldList, value: rightLink" class="form-control-sm"></select></td>
                    <td><a href="#" data-bind="click: $root.removeLink">X</a></td>
                </tbody>
            </table>
            <button type="button" class="btn btn-outline-primary btn-sm" data-bind="click: addLink">Add Link</button></br></br>

            <strong>order by:</strong></br>
            <table class="table table-sm ">
                <th>Field</th><th>Asc/Desc</th><th>X</th>
                <tbody data-bind="foreach: sorts">
                    <td><select data-bind="options: $root.selectedFields, value: sortField" class="form-control-sm"></select></td>
                    <td><select data-bind="options: $root.sortDirections, value: sortDirection" class="form-control-sm"></select></td>
                    <td><a href="#" data-bind="click: $root.removeSort">X</a></td>
                </tbody>
            </table>
            <button type="button" class="btn btn-outline-primary btn-sm" data-bind="click: addSort">Add Sorting</button></br>
        </div>

        <div class="col-sm">
            <strong>Select right file to merge:</strong></br>
            <select data-bind="options: datasetsList, value: rightFile, event:{change: fetchRightFields}" class="form-control" ></select>
            <label for="rightcolselect">Select right fields:</label>
			<select data-bind="options: rightFieldList, value: rightField, event:{change: addRightFieldSelect}" id="rightcolselect" class="form-control" name="rightcolselect" size="10"></select>
        </div>
    </div>
</div>

<div class="container">
    SELECT <span data-bind="text: selectedFields" class="h6"></span> <a href="#" data-bind="click: $root.removeSelectField">X</a>
</div>
<div class="container">
    from <span class="h6"  data-bind="text: sq.leftFile"></span>
    inner join  <span class="h6" data-bind="text: rightFile"> </span>
</div>
<div class="container">
    <span data-bind="foreach: links">
        ON (<span data-bind="text: leftLink"></span> = <span data-bind="text: rightLink"></span>)</span></br>
     </span>
</div>

<div class="container">
    WHERE <input class="form-control" data-bind="value: whereClause" />
</div>


<div class="container">

        <button class="btn btn-primary btn-success" data-bind="click: runQuery">Run query</button>
        <button class="btn btn-primary" data-bind="click: saveQueryModal">Save query</button>
        <button class="btn btn-danger" data-bind="click: runQuery3">Run query3</button>
</div>

<p></p>
<div class = "container-fluid">

    <table id="queryTable" class="display">
        <thead id="queryTableHead"></thead>
    </table>
</div>

<!-- Modal to show the save pop-up -->

<div id= "saveModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Save query to the server</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <table width="100%">
            <tr>
                <td width="150">Query Name:</td><td><input class="form-control form-control-sm" type="text"></td>
            </tr><tr>
                <td>Scope:</td><<td><input class="form-control form-control-sm" type="text"></td>
            </tr><tr>
                <td>Description:</td><td><textarea class="form-control" rows="3"></textarea></td>
            </tr><tr>
                <td>Left Domain:</td><td><span data-bind="text: sq.leftFile"></span></td>
            </tr><tr>
                <td>Right Domain:</td><td><span data-bind="text: rightFile"></span></td>
            </tr><tr>
                <td>Selected fields:</td><td><span data-bind="text: selectedFields"></span></td>
            </tr><tr>
                <td>Order by:</td><td><span data-bind="text: sorts"></span></td>
            </tr><tr>
                <td>SQL:</td><td><span data-bind="text: sq.SQLquery"></td>
            </tr>
        </table>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Save query</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


{% endblock %}

{% block scripts %}
	<!-- Optional JavaScript -->
    {{ super() }}
    <!-- <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/knockout/2.2.0/knockout-min.js"></script> -->
    <script src="{{ url_for('static', filename='./js/knockout-min.js') }}"></script>
    <script src="{{ url_for('static', filename='./js/cloudds.js') }}"></script>

{% endblock %}